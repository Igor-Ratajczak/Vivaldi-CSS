/* VIVALDI ZEN THEME - Auto-hide Interface */
/* Modernized with CSS Nesting, Logical Properties, View Transitions, and Color Functions */

/* ========== VIEW TRANSITIONS ========== */
@view-transition {
    navigation: auto;
}

::view-transition-group(header) {
    animation-duration: 0.3s;
    animation-timing-function: cubic-bezier(0, 0.58, 0.71, 1.27);
}

::view-transition-group(panels) {
    animation-duration: 0.2s;
    animation-timing-function: ease-out;
}
/** {
    color: black
}*/

/* ========== CSS VARIABLES ========== */
:root {
    /* Background Configuration */
    --background: #2d6619;
    /* --background: url("chrome://vivaldi-data/thumbnail/O3CNZC67HXCG6MMASH7YCHCIJUNBQMLE.jpg"); */
    --background-size: 100vw 100vh;

    /* Layout Dimensions */
    --header-height: 40px;
    --mainbar-height: 50px;
    --bookmark-height: 50px;
    --tab-stacking-offset: 0px;

    /* Modern Color Scheme using oklch */
    --hover-color-minimize: oklch(0.55 0.15 180);
    --hover-color-maximize: oklch(0.55 0.15 180);
    --hover-color-close: oklch(0.35 0.2 0);
    --window-button-border: 1px solid oklch(1 0 0);
    --accent-bg: color-mix(in oklch, var(--colorAccentBg) 90%, transparent);
    --accent-fg: color-mix(in oklch, var(--colorAccentFg) 95%, transparent);

    /* Window Controls */
    --window-button-size: 28px;
    --window-button-border-radius: 25px;
    --titlebar-height: 40px;

    /* Tab Configuration */
    --tab-width-vertical: 250px;
    --tab-width-stacked: 500px;
    --tab-translate-offset: 120%;
    --tab-hover-translate-left: 5px;
    --tab-hover-translate-right: -100%;

    /* Z-Index Layers */
    --z-tooltip: 9999999;
    --z-popup: 100000;
    --z-header: 1020;
    --z-mainbar: 1010;
    --z-bookmark: 1001;
    --z-window-controls: 10000;
    --z-panels: 999;
    --z-tabs: 100;

    /* Animation & Transitions */
    --transition-main: transform 0.2s 0.1s cubic-bezier(0, 0.58, 0.71, 1.27);
    --transition-tabs: transform 0.2s 0.2s cubic-bezier(0, 0.58, 0.49, 1.14);
    --transition-panels: width 0.2s ease-out;
    --transition-page: opacity 0.7s;
    --transition-newtab: opacity 200ms ease 150ms;

    /* Default positions (hidden state) */
    --header-Y: calc(-100px);
    --mainbar-Y: calc(-70px);
    --bookmark-Y: calc(-40px);

    /* Hover positions */
    --header-hover-Y: calc(0px);
    --mainbar-hover-Y: calc(0px + var(--tab-stacking-offset));
    --bookmark-hover-Y: calc(40px + var(--tab-stacking-offset));

    /* Tabs-top positions */
    --mainbar-tabs-top-hover-Y: calc(40px + var(--tab-stacking-offset));
    --bookmark-tabs-top-hover-Y: calc(80px + var(--tab-stacking-offset));

    /* Edit mode positions */
    --mainbar-edit-Y: calc(40px + var(--tab-stacking-offset));
    --bookmark-edit-Y: calc(80px + var(--tab-stacking-offset));
}

/* Tab stacking offset when enabled */
:root:has(
    #browser.substrip-tabs-on
        > #header
        > .tabbar-wrapper
        > #tabs-tabbar-container
        > #tabs-subcontainer
) {
    --tab-stacking-offset: 30px;
}

#browser > #header,
#browser > #main > .mainbar,
#browser.bookmark-bar-top > #main > .bookmark-bar,
#browser:is(.tabs-left, .tabs-right) #tabs-subcontainer,
#browser:is(.tabs-left, .tabs-right) #tabs-subcontainer .tab-strip {
    will-change: auto;
}
#browser > #header:hover,
#browser > #main > .mainbar:hover,
#browser.bookmark-bar-top > #main > .bookmark-bar:hover,
#browser:is(.tabs-left, .tabs-right) #tabs-subcontainer:hover,
#browser:is(.tabs-left, .tabs-right) #tabs-subcontainer .tab-strip:hover {
    will-change: transform;
}

/* Remove reader view button */
.button-toolbar:has(button.ToolbarButton-Button[aria-label="Reader View"]) {
    display: none;
}
/* ========== MAIN BROWSER CONTAINER ========== */

/* Main auto-hide functionality (exclude settings page) */
:not(:has(#browser > #main > .webpageview > .settings-container)) {
    /* ========== BROWSER LAYOUT ADJUSTMENTS ========== */
    #browser {
        /* Adjust positions when bookmark bar is disabled */
        &:is(.bookmark-bar-top-off, .bookmark-bar-bottom-off) {
            --header-Y: calc(-80px);
            --mainbar-Y: calc(-40px);
        }

        &.bookmark-bar-bottom {
            --mainbar-Y: -40px;
        }

        /* Special cases */
        &:is(.bookmark-bar-top-off, .bookmark-bar-bottom-off) {
            --header-Y: calc(-80px);
        }

        /* Grid layout adjustments */
        & > #main {
            grid-row: 2;
        }

        & > #footer {
            grid-row: 3;
        }
    }

    /* ========== HEADER CONFIGURATION ========== */
    #browser > #header {
        transform: translateY(var(--header-Y));
        z-index: var(--z-header);
        position: absolute;
        width: 100%;
        inset-block-start: 0;
        transition: var(--transition-main);
        align-content: center;

        & {
            background: var(--background) !important;
            background-size: var(--background-size) !important;
            -webkit-app-region: none !important;
        }
    }

    /* ========== MAIN TOOLBAR CONFIGURATION ========== */
    #browser > #main > .mainbar {
        position: absolute;
        width: 100%;
        transform: translateY(var(--mainbar-Y));
        height: var(--mainbar-height);
        z-index: var(--z-mainbar);
        border: none;
        transition: var(--transition-main);
        align-content: center;

        /* Background mask to hide artifacts */
        &::before {
            content: "";
            width: 100%;
            height: calc(80px + var(--tab-stacking-offset));
            background: var(--background);
            position: absolute;
            display: block;
            inset-block-start: calc(-100% - var(--tab-stacking-offset));
            inset-inline-start: 0;
            z-index: -1;
        }
    }

    .mainbar {
        background: var(--background) !important;
        background-size: var(--background-size) !important;
        -webkit-app-region: none !important;
    }

    /* ========== BOOKMARK BAR CONFIGURATION ========== */
    #browser.bookmark-bar-top > #main > .bookmark-bar {
        position: absolute;
        width: 100%;
        transform: translateY(var(--bookmark-Y));
        height: var(--bookmark-height);
        z-index: var(--z-bookmark);
        border: none;
        transition: var(--transition-main);
        align-content: center;
    }

    .bookmark-bar {
        background: var(--background) !important;
        background-size: var(--background-size) !important;
        -webkit-app-region: none !important;
    }
    #browser > #header *,
    .mainbar > *,
    .bookmark-bar.default *,
    .bookmark-bar * {
        background: transparent !important;
        background-size: var(--background-size) !important;
        -webkit-app-region: none !important;
    }

    /* ========== HOVER INTERACTIONS - COMPLEX LOGIC ========== */
    /* TABS-TOP MODE - Header shows first on hover */
    #browser {
        &.tabs-top:has(
                :is(
                    #header,
                    .mainbar,
                    .ToolbarButtonPopup-DefaultStyles,
                    .ToolbarButtonPopup-DefaultStyles *
                ):hover
            ),
        &.bookmark-bar-top:has(:is(.bookmark-bar):hover) {
            --header-Y: calc(0px);
            --mainbar-Y: var(--mainbar-tabs-top-hover-Y);
            --bookmark-Y: var(--bookmark-tabs-top-hover-Y);
        }

        /* TABS-LEFT/RIGHT/BOTTOM MODE - Different stacking order */
        &:is(.tabs-left, .tabs-right, .tabs-bottom):has(
                :is(#header, .mainbar):hover
            ),
        &.bookmark-bar-top:is(.tabs-left, .tabs-right, .tabs-bottom):has(
                :is(.bookmark-bar):hover
            ),
        &.toolbar-edit-mode {
            --mainbar-Y: calc(0px + var(--tab-stacking-offset)) !important;
            --bookmark-Y: calc(40px + var(--tab-stacking-offset)) !important;
        }

        /* TOOLBAR EDIT MODE - FORCE VISIBILITY */
        &.toolbar-edit-mode {
            & > #header {
                --header-Y: var(--header-hover-Y) !important;
            }

            &.tabs-top {
                --mainbar-Y: var(--mainbar-edit-Y) !important;
            }

            &.bookmark-bar-top {
                --bookmark-Y: var(--bookmark-edit-Y) !important;
            }

            &.bookmark-bar-top:is(.tabs-left, .tabs-right, .tabs-bottom) {
                --mainbar-Y: calc(0px + var(--tab-stacking-offset)) !important;
                --bookmark-Y: calc(
                    40px + var(--tab-stacking-offset)
                ) !important;
            }
        }

        /* URL BAR DROPDOWN - FORCE VISIBILITY */
        &:has(.UrlBar-UrlFieldWrapper .OmniDropdown) {
            --header-Y: calc(0px);
            --mainbar-Y: var(--mainbar-edit-Y) !important;

            &.bookmark-bar-top {
                --bookmark-Y: var(--bookmark-edit-Y) !important;

                &.tabs-top {
                    --bookmark-Y: var(--bookmark-tabs-top-hover-Y) !important;
                }

                &:not(.tabs-top) {
                    --mainbar-Y: calc(
                        0px + var(--tab-stacking-offset)
                    ) !important;
                    --bookmark-Y: calc(
                        40px + var(--tab-stacking-offset)
                    ) !important;
                }
            }
        }

        /* BOOKMARK BAR SPECIAL CASES */
        &.bookmark-bar-top:is(.tabs-left, .tabs-right, .tabs-bottom):has(
                :is(#header, .mainbar, .bookmark-bar):hover
            ) {
            --bookmark-Y: calc(50px + var(--tab-stacking-offset)) !important;
        }
    }

    /* ========== TAB STYLING AND BEHAVIOR ========== */
    #browser .tab.active * {
        background: var(--accent-bg) !important;
        color: var(--accent-fg) !important;
    }

    .svg-tab-stack {
        display: none;
    }

    /* ========== VERTICAL TABS BEHAVIOR ========== */
    #browser {
        &.tabs-left:has(:is(#panels-container.left):hover)
            #tabs-tabbar-container.left {
            transform: translateX(var(--tab-hover-translate-left)) !important;
        }

        &.tabs-right:has(:is(#panels-container.right):hover)
            #tabs-tabbar-container.right {
            transform: translateX(var(--tab-hover-translate-right)) !important;
        }

        &:is(.tabs-left, .tabs-right):has(
                :is(
                    .tabbar-wrapper,
                    .ToolbarButtonPopup-DefaultStyles,
                    .ToolbarButtonPopup-DefaultStyles *
                ):hover
            ) {
            & #tabs-tabbar-container.left {
                transform: translateX(
                    var(--tab-hover-translate-left)
                ) !important;
            }

            & #tabs-tabbar-container.right {
                transform: translateX(
                    var(--tab-hover-translate-right)
                ) !important;
            }
        }

        &.tabs-bottom #tabs-tabbar-container {
            transition: var(--transition-tabs);
            background: var(--background) !important;
            background-size: var(--background-size) !important;
            background-attachment: fixed !important;
            background-position: bottom;
        }
    }
    #tabs-subcontainer {
        background: transparent;
    }
    /* ========== VERTICAL TABS LAYOUT ========== */
    #browser:is(.tabs-left, .tabs-right) {
        .tabbar-wrapper {
            &:has(#tabs-subcontainer) #tabs-tabbar-container {
                width: var(--tab-width-stacked) !important;
            }

            & #tabs-tabbar-container,
            & #tabs-subcontainer,
            & #tabs-subcontainer .tab-strip {
                width: var(--tab-width-vertical) !important;
            }

            width: 10px;
            z-index: var(--z-tabs);
            background: var(--background) !important;

            &:empty {
                display: none !important;
            }
        }

        #tabs-subcontainer,
        #tabs-subcontainer .tab-strip {
            transition: var(--transition-main);
        }

        #tabs-tabbar-container {
            position: absolute;
            transition: var(--transition-tabs);
            background: var(--background) !important;
            background-size: var(--background-size) !important;
            inset-block-start: 0;
            background-attachment: fixed !important;
            height: 100%;

            &.right {
                transform: translateX(var(--tab-translate-offset));
                background-position: right !important;
            }

            &.left {
                transform: translateX(calc(-1 * var(--tab-translate-offset)));
                background-position: left !important;
            }

            &.left:has(
                    button.ToolbarButton-Button[name="WorkspaceButton"][aria-expanded="true"]
                ) {
                transform: translateX(-100%);
            }

            &.right:has(
                    button.ToolbarButton-Button[name="WorkspaceButton"][aria-expanded="true"]
                ) {
                transform: translateX(100%);
            }
        }

        .button-popup {
            pointer-events: auto;
            position: fixed;
            z-index: 1000 !important;
        }
    }

    #browser.tabs-left .tabbar-wrapper {
        background-position: left !important;
    }

    #browser.tabs-right .tabbar-wrapper {
        background-position: right !important;
    }

    /* ========== WINDOW CONTROLS ========== */
    .window-buttongroup {
        height: 100%;
        align-items: center;
        inset-block-start: 0 !important;

        & button {
            width: var(--window-button-size) !important;
            height: var(--window-button-size) !important;
            border: var(--window-button-border) !important;
            z-index: var(--z-window-controls);
            border-radius: var(--window-button-border-radius);
        }
    }

    #titlebar {
        height: var(--titlebar-height);
    }

    #browser .window-buttongroup {
        .window-minimize:hover {
            background: var(--hover-color-minimize) !important;
        }

        .window-maximize:hover {
            background: var(--hover-color-maximize) !important;
        }

        .window-close:hover {
            background: var(--hover-color-close) !important;
        }
    }

    /* ========== PANELS CONFIGURATION ========== */
    #panels-container {
        background: var(--background) !important;
        z-index: var(--z-panels);

        &.right {
            background-position: right !important;
        }

        &.left {
            background-position: left !important;
        }
    }

    :not(.resizing)#panels-container.overlay .panel-group {
        transition: var(--transition-panels) !important;
    }

    /* ========== URL BAR AND FORM ELEMENTS ========== */
    .UrlBar-AddressField {
        background: var(--background) !important;
        background-size: var(--background-size) !important;
        border: none !important;
    }

    #main {
        border: none !important;
    }

    /* ========== Z-INDEX MANAGEMENT ========== */
    .ToolbarButtonPopup-DefaultStyles,
    .ToolbarButtonPopup-DefaultStyles * {
        z-index: var(--z-popup);
    }

    #vivaldi-tooltip {
        z-index: var(--z-tooltip);
    }

    /* ========== FULLSCREEN MODE ========== */
    #browser.fullscreen {
        & #main {
            grid-template: 0 auto 0 / 100%;
        }

        & .mainbar {
            display: none;
        }
    }
}

#main > .inner {
    grid-row: 2;
    margin-block-start: 5px;
}

/* ========== PAGE TRANSITIONS ========== */
.webpageview {
    visibility: visible !important;
    transition: var(--transition-page);
    view-transition-name: page-content;
}

@starting-style {
    .webpageview {
        opacity: 0 !important;
    }
}

/* ========== START PAGE STYLING ========== */
.startpage
    *:not(#speeddial-settings-pane, #speeddial-settings-pane *, .OmniDropdown) {
    background: transparent;
    box-shadow: none;
}

/* ========== FOOTER ========== */
#footer {
    background: transparent !important;
}

#modal-bg.toolbar-editor {
    z-index: 11111;
}
